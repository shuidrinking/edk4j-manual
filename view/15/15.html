<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<link type="text/css"  rel="stylesheet" href="../../css/dom.css"/>
	<script type="text/javascript" src="../../javascript/core/domUtil.js"></script>
</head>
<body >
	<div id="title" class="titleDiv">
		15、用户访问、登录、退出、关闭客户端专题
	</div>
	<div class="subTitleDiv addArrow">
		1、游客访问要做什么
	</div>
	<div class="subContentDiv">
		<div style="text-indent:0.32rem;">
		首次访问，便要保证创建sessionContext，具体如何保证，技术经理要仔细研究系统的特点，如果是app比较好办，一打开就向后台发送请求，获得requestToken后缓存在app里便可，如果是pc机网页访问，要么要采用cookie机制，要么要在js脚本上下功夫。
		</div>
		<div style="text-indent:0.32rem;">
		客户端有禁止cookie的可能，所以通用性的做法是：后台提供专门建立sessionContext的URL，前台提供一个所有页面都需要应用的js，这个js里实现在页面加载时如果判定没有requestToken的话就获取一次。
		</div>
	</div>
	<div class="subTitleDiv addArrow">
		2、登录要做些什么
	</div>
	<div class="subContentDiv">
		更新客户的sessionContext，除了应对具体应用中的登录数据外，有下面几个数据必须要保证：
		<table class="across">
			<colgroup>
				<col style="width:300px;"/>
				<col/>
			</colgroup>
			<tbody>
				<tr><td>sessionCustInfo</td><td>值为User对象，创建时，其中的httpSessionId和clientIp有值，其他值为空。所以，登录时要把其他值补充进去</td></tr>
				<tr><td>sessionUserLoginFlag</td><td>创建时为"false"，登录后要设置为"true"，注意，保存的是字符串，不要保存boolean值进去！</td></tr>
				<tr><td>sessionDynamicData</td><td>等几个并行缓存的字段	保存动态数据域的数据缓存在缓存服务器上的key</td></tr>
			</tbody>
		</table>
	</div>
	<div class="subTitleDiv addArrow">
		3、退出要做些什么
	</div>
	<div class="subContentDiv">
		<p style="text-indent:0.32rem;">
		调用SessionService.rollBackSessionToUnLogin方法，将session回退到未登录状态，要把登录相关的数据都恢复掉，例如修改登录状态为"false"，将可操作的菜单和可操作的businessCode恢复到“游客级别”，将平行缓存的数据内容也恢复到“游客级别”，也就是说，登录要做的动作，在这里要逆着做！
		</p>
	</div>
	<div class="subTitleDiv addArrow">
		4、关闭客户端时要干些什么
	</div>
	<div class="subContentDiv">
		<p style="text-indent:0.32rem;">
		将sessionContext销毁掉！
		</p>
	</div>
</body>
</html>